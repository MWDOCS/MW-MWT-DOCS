import{u as I,f as $,h as ee,i as U,j as le,k as se,t as ae,l as te,m as A,p as q,q as he,s as B,v as s,x as O,y as _,R as F,z as ne,A as oe,B as re,C as ie,O as ue,P as ce,D as me,E as ve,F as we,G as de,H as pe,I as ye,J as ze,K as E}from"./app-DizVV_-7.js";const fe=["/","/zh-hans/assets.html","/zh-hans/de.html","/zh-hans/","/zh-hans/md.html","/zh-hans/sitehelp.html","/zh-hans/up.html","/zh-hant/","/zh-hans/account/apkxa.html","/zh-hans/account/google.html","/zh-hans/account/","/zh-hans/account/ios.html","/zh-hans/markdown/","/zh-hans/mw/game-info.html","/zh-hans/mw/","/zh-hans/mw/mw-press.html","/zh-hans/mwt/","/zh-hans/markdown/other/","/zh-hans/mw/collection/cn-warships.html","/zh-hans/mw/collection/cn.html","/zh-hans/mw/collection/ct.html","/zh-hans/mw/collection/ctto.html","/zh-hans/mw/collection/egg.html","/zh-hans/mw/collection/events-less.html","/zh-hans/mw/collection/","/zh-hans/mw/collection/lj.html","/zh-hans/mw/collection/market.html","/zh-hans/mw/collection/musk.html","/zh-hans/mw/collection/mw68.html","/zh-hans/mw/collection/mw70.html","/zh-hans/mw/collection/mw77.html","/zh-hans/mw/collection/mwben.html","/zh-hans/mw/collection/news.html","/zh-hans/mw/collection/pan.html","/zh-hans/mw/column/","/zh-hans/mw/download/app.html","/zh-hans/mw/download/","/zh-hans/mw/download/mod.html","/zh-hans/mw/download/pc.html","/zh-hans/mw/download/sys.html","/zh-hans/mw/download/zg.html","/zh-hans/mw/official/bp.html","/zh-hans/mw/official/bs.html","/zh-hans/mw/official/","/zh-hans/mw/official/jd.html","/zh-hans/mw/official/lt.html","/zh-hans/mw/official/qt.html","/zh-hans/mw/official/sc.html","/zh-hans/mw/official/sd.html","/zh-hans/mw/official/wf.html","/zh-hans/mw/official/yj.html","/zh-hans/mw/official/zb.html","/zh-hans/mw/official/zd.html","/zh-hans/mw/official/zh.html","/zh-hans/mw/official/zy.html","/zh-hans/mw/skills/cyct.html","/zh-hans/mw/skills/game.html","/zh-hans/mw/skills/","/zh-hans/mw/skills/mom.html","/zh-hans/mw/skills/mw-rules.html","/zh-hans/mw/skills/stan-bilibili.html","/zh-hans/mw/skills/x51.html","/zh-hans/mw/column/realitymw/bomber.html","/zh-hans/mw/column/realitymw/fighter.html","/zh-hans/mw/column/realitymw/helicopter.html","/zh-hans/mw/column/realitymw/","/zh-hans/mw/column/realitymw/strike-fighters.html","/zh-hans/mw/column/realitymw/uav.html","/zh-hans/mw/column/realitymw2/cruiser.html","/zh-hans/mw/column/realitymw2/destroyer.html","/zh-hans/mw/column/realitymw2/","/404.html"],ge="SEARCH_PRO_QUERY_HISTORY",v=I(ge,[]),ke=()=>{const{queryHistoryCount:a}=E,t=a>0;return{enabled:t,queryHistory:v,addQueryHistory:h=>{t&&(v.value.length<a?v.value=Array.from(new Set([h,...v.value])):v.value=Array.from(new Set([h,...v.value.slice(0,a-1)])))},removeQueryHistory:h=>{v.value=[...v.value.slice(0,h),...v.value.slice(h+1)]}}},D=a=>fe[a.id]+("anchor"in a?`#${a.anchor}`:""),He="SEARCH_PRO_RESULT_HISTORY",{resultHistoryCount:C}=E,w=I(He,[]),Re=()=>{const a=C>0;return{enabled:a,resultHistory:w,addResultHistory:t=>{if(a){const h={link:D(t),display:t.display};"header"in t&&(h.header=t.header),w.value.length<C?w.value=[h,...w.value]:w.value=[h,...w.value.slice(0,C-1)]}},removeResultHistory:t=>{w.value=[...w.value.slice(0,t),...w.value.slice(t+1)]}}},Qe=a=>{const t=ue(),h=U(),{search:H,terminate:c}=ce(),p=A(!1),y=me([]);return ve(()=>{const d=()=>{y.value=[],p.value=!1},R=ze(z=>{p.value=!0,z?H({type:"search",query:z,locale:h.value,options:t.value}).then(m=>{y.value=m,p.value=!1}).catch(m=>{console.error(m),d()}):d()},E.searchDelay);B([a,h],()=>R(a.value),{immediate:!0}),we(()=>{c()})}),{searching:p,results:y}};var be=$({name:"SearchResult",props:{query:{type:String,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(a,{emit:t}){const h=ee(),H=U(),c=le(se),{enabled:p,addQueryHistory:y,queryHistory:d,removeQueryHistory:R}=ke(),{enabled:z,resultHistory:m,addResultHistory:L,removeResultHistory:M}=Re(),P=p||z,Q=ae(a,"query"),{results:f,searching:Y}=Qe(Q),n=te({isQuery:!0,index:0}),i=A(0),u=A(0),T=q(()=>P&&(d.value.length>0||m.value.length>0)),x=q(()=>f.value.length>0),b=q(()=>f.value[i.value]||null),G=()=>{const{isQuery:e,index:l}=n;l===0?(n.isQuery=!e,n.index=e?m.value.length-1:d.value.length-1):n.index=l-1},J=()=>{const{isQuery:e,index:l}=n;l===(e?d.value.length-1:m.value.length-1)?(n.isQuery=!e,n.index=0):n.index=l+1},K=()=>{i.value=i.value>0?i.value-1:f.value.length-1,u.value=b.value.contents.length-1},V=()=>{i.value=i.value<f.value.length-1?i.value+1:0,u.value=0},N=()=>{u.value<b.value.contents.length-1?u.value+=1:V()},W=()=>{u.value>0?u.value-=1:K()},S=e=>e.map(l=>de(l)?l:s(l[0],l[1])),X=e=>{if(e.type==="customField"){const l=pe[e.index]||"$content",[o,k=""]=ye(l)?l[H.value].split("$content"):l.split("$content");return e.display.map(r=>s("div",S([o,...r,k])))}return e.display.map(l=>s("div",S(l)))},g=()=>{i.value=0,u.value=0,t("updateQuery",""),t("close")};return he("keydown",e=>{if(a.isFocusing){if(x.value){if(e.key==="ArrowUp")W();else if(e.key==="ArrowDown")N();else if(e.key==="Enter"){const l=b.value.contents[u.value];y(a.query),L(l),h.push(D(l)),g()}}else if(z){if(e.key==="ArrowUp")G();else if(e.key==="ArrowDown")J();else if(e.key==="Enter"){const{index:l}=n;n.isQuery?(t("updateQuery",d.value[l]),e.preventDefault()):(h.push(m.value[l].link),g())}}}}),B([i,u],()=>{var e;(e=document.querySelector(".search-pro-result-list-item.active .search-pro-result-item.active"))==null||e.scrollIntoView(!1)},{flush:"post"}),()=>s("div",{class:["search-pro-result-wrapper",{empty:Q.value?!x.value:!T.value}],id:"search-pro-results"},Q.value===""?P?T.value?[p?s("ul",{class:"search-pro-result-list"},s("li",{class:"search-pro-result-list-item"},[s("div",{class:"search-pro-result-title"},c.value.queryHistory),d.value.map((e,l)=>s("div",{class:["search-pro-result-item",{active:n.isQuery&&n.index===l}],onClick:()=>{t("updateQuery",e)}},[s(O,{class:"search-pro-result-type"}),s("div",{class:"search-pro-result-content"},e),s("button",{class:"search-pro-remove-icon",innerHTML:_,onClick:o=>{o.preventDefault(),o.stopPropagation(),R(l)}})]))])):null,z?s("ul",{class:"search-pro-result-list"},s("li",{class:"search-pro-result-list-item"},[s("div",{class:"search-pro-result-title"},c.value.resultHistory),m.value.map((e,l)=>s(F,{to:e.link,class:["search-pro-result-item",{active:!n.isQuery&&n.index===l}],onClick:()=>{g()}},()=>[s(O,{class:"search-pro-result-type"}),s("div",{class:"search-pro-result-content"},[e.header?s("div",{class:"content-header"},e.header):null,s("div",e.display.map(o=>S(o)).flat())]),s("button",{class:"search-pro-remove-icon",innerHTML:_,onClick:o=>{o.preventDefault(),o.stopPropagation(),M(l)}})]))])):null]:c.value.emptyHistory:c.value.emptyResult:Y.value?s(ne,{hint:c.value.searching}):x.value?s("ul",{class:"search-pro-result-list"},f.value.map(({title:e,contents:l},o)=>{const k=i.value===o;return s("li",{class:["search-pro-result-list-item",{active:k}]},[s("div",{class:"search-pro-result-title"},e||c.value.defaultTitle),l.map((r,Z)=>{const j=k&&u.value===Z;return s(F,{to:D(r),class:["search-pro-result-item",{active:j,"aria-selected":j}],onClick:()=>{y(a.query),L(r),g()}},()=>[r.type==="text"?null:s(r.type==="title"?oe:r.type==="heading"?re:ie,{class:"search-pro-result-type"}),s("div",{class:"search-pro-result-content"},[r.type==="text"&&r.header?s("div",{class:"content-header"},r.header):null,s("div",X(r))])])})])})):c.value.emptyResult)}});export{be as default};
